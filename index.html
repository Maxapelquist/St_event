<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upplägg 1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 20px 0;
        }

        h1 {
            margin: 0;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .table-container {
            display: flex;
            justify-content: space-between;
        }

        table {
            width: 30%;
            border-collapse: collapse;
            margin: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th {
            background-color: #333;
            color: #fff;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            padding: 10px;
        }

        th span {
            display: block;
        }

        td {
            padding: 10px;
            text-align: left;
        }

        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .donation-text {
            text-align: center;
            margin: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .position {
            font-weight: bold;
        }

        /* Lägg till stil för dropdown-listan */
        .day-selector {
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <h1>Välkommen till Mitt Evenemang</h1>
    </header>
    <main>
        <!-- Lägg till dropdown-lista för dagval -->
        <div class="day-selector">
            <label for="day">Välj dag:</label>
            <select id="day" onchange="updateData()">
                <!-- Generera automatiskt alternativ för varje dag -->
                <script>
                    const numDays = 10; // Ange det maximala antalet dagar här
                    for (let i = 1; i <= numDays; i++) {
                        document.write(`<option value="${i}">Dag ${i}</option>`);
                    }
                </script>
            </select>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th colspan="3">
                            Herr
                        </th>
                    </tr>
                    <tr>
                        <th>Namn</th>
                        <th>Tid</th>
                    </tr>
                </thead>
                <tbody id="herr-body">
                    <!-- Data for Herr will be populated here -->
                </tbody>
            </table>
            <table>
                <thead>
                    <tr>
                        <th colspan="3">
                            Dam
                        </th>
                    </tr>
                    <tr>
                        <th>Namn</th>
                        <th>Tid</th>
                    </tr>
                </thead>
                <tbody id="dam-body">
                    <!-- Data for Dam will be populated here -->
                </tbody>
            </table>
            <table>
                <thead>
                    <tr>
                        <th colspan="3">
                            Ungdom
                        </th>
                    </tr>
                    <tr>
                        <th>Namn</th>
                        <th>Tid</th>
                    </tr>
                </thead>
                <tbody id="ungdom-body">
                    <!-- Data for Ungdom will be populated here -->
                </tbody>
            </table>
        </div>
        <div class="donation-text">
            Tillsammans har vi samlat in <span id="donation-amount-text">0</span> kr till Suicide Zero
        </div>
        <div class="logo">
            <img src="st_logo.png" alt="Suicide Zero Logo">
        </div>
    </main>
    <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const apiKey = 'AIzaSyAA3_S2jNmaQtOk7MLdaQjmjtfdDjmjMJw';
    const spreadsheetId = '1jO7hIqR3vITWpnqKK5d4puz_jQZhYqEr-YgT5R6hgHg';
    const sheetName = 'Form';
    const maxNumDays = 10; // Ange det maximala antalet dagar här

    document.getElementById('day').addEventListener('change', function() {
        updateData();
    });

    // Funktion för att initiera Google API
    function initGoogleAPI() {
        gapi.load('client', init);
    }

    // Funktion för att initiera Google API
    function init() {
        if (typeof gapi !== 'undefined') {
            gapi.client.init({
                'apiKey': apiKey,
                'discoveryDocs': ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            }).then(() => {
                // Återställ det valda dagvärdet från localStorage
                const savedDay = localStorage.getItem('selectedDay');
                if (savedDay) {
                    document.getElementById('day').value = savedDay;
                }

                // Starta första uppdateringen
                updateData();

                // Uppdatera datan var 5 sekunder
                setInterval(updateData, 5000);

            }).catch(error => {
                console.error('Error initializing:', error);
            });
        } else {
            console.error('gapi is not defined.');
        }
    }

    function getDataFromGoogleSheets(selectedDay) {
        const dataRange = `${sheetName}!A:D`;

        return gapi.client.sheets.spreadsheets.values.get({
            spreadsheetId: spreadsheetId,
            range: dataRange,
        }).then(response => {
            console.log('API Response:', response);
            return response.result.values;
        }).catch(error => {
            console.error('Error fetching data from Google Sheets:', error);
            throw error;
        });
    }


function populateTable(data, selectedDay) {
    const categoryBodies = {
        'Herr': document.getElementById('herr-body'),
        'Dam': document.getElementById('dam-body'),
        'Ungdom': document.getElementById('ungdom-body'),
    };

    data.shift(); // Remove header row

    data.forEach(row => {
        const [name, time, , day] = row; // Ignore category and extract day

        if (day === selectedDay) { // Check if day matches the selected day
            const tr = document.createElement('tr');
            const tdName = document.createElement('td');
            const tdTime = document.createElement('td');

            tdName.textContent = name;
            tdTime.textContent = time + ' sekunder';

            tr.appendChild(tdName);
            tr.appendChild(tdTime);

            // Find the category body based on the current row's category
            const category = row[2]; // Extract the category from the row
            const categoryBody = categoryBodies[category];

            if (categoryBody) {
                categoryBody.appendChild(tr);
            } else {
                console.error('Category body not found for category:', category);
                console.log('Data for the row:', row);
            }
        }
    });
}



    // Funktion för att uppdatera datan på sidan
    function updateData() {
        // Hämta det valda dagvärdet från dropdown-listan
        const selectedDay = document.getElementById('day').value;
        console.log('Selected Day:', selectedDay); // Lägg till detta för att felsöka

        // Spara det valda dagvärdet i localStorage
        localStorage.setItem('selectedDay', selectedDay);

        // Hämta data från Google Sheets baserat på vald dag
        getDataFromGoogleSheets(selectedDay).then(data => {
            // Rensa befintlig tabell innan uppdatering
            ['herr-body', 'dam-body', 'ungdom-body'].forEach(categoryId => {
                const categoryBody = document.getElementById(categoryId);
                if (categoryBody) {
                    categoryBody.innerHTML = '';
                }
            });

            // Fyll i tabellen med data från de valda kolumnerna
            populateTable(data, selectedDay);
        }).catch(error => {
            console.error(error);
        });
    }

    // Lägg till händelselyssnare när DOM har laddats
    document.addEventListener('DOMContentLoaded', initGoogleAPI);
</script>
</body>
</html>